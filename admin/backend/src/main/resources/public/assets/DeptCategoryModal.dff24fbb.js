var I=(e,t,s)=>new Promise((n,u)=>{var c=o=>{try{i(s.next(o))}catch(l){u(l)}},C=o=>{try{i(s.throw(o))}catch(l){u(l)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(c,C);i((s=s.apply(e,t)).next())});import{c as k,ap as D,a as M,v as R,s as h,ar as p,o as B,j as S,y as f,n as d,z as L,t as O,as as E}from"./index.9b68f3a5.js";import{C as P}from"./index.e9a061d5.js";/* empty css              */import{D as $}from"./index.c90ef721.js";import{B as N,a as V}from"./index.c6d9e38a.js";import{B as x}from"./TableImg.56506859.js";import{T as F}from"./index.3604fdfb.js";import{u as U}from"./useTable.bd2598d0.js";import{a as z,s as K,b as Y}from"./dept.1369de14.js";import{i as j}from"./isEmpty.7bce0800.js";import{C as q}from"./index.b8e26f6f.js";import{R as G}from"./index.b9fae046.js";import"./Checkbox.0353578e.js";import"./useWindowSizeFn.d868051d.js";import"./FullscreenOutlined.33f2b7f2.js";import"./index.7b6b1e1d.js";import"./index.6b109d0e.js";import"./eagerComputed.4def26ea.js";import"./BasicForm.6899d0a5.js";/* empty css               */import"./index.6344e34d.js";import"./index.ea5e7c7e.js";import"./index.f5ce31a5.js";import"./index.8a286a94.js";import"./get.8f01bfdb.js";import"./index.3fe76539.js";import"./_baseEach.e6ca9cd4.js";import"./_baseIteratee.f572c494.js";import"./_baseProperty.2030e337.js";import"./DeleteOutlined.8d0b60c9.js";import"./index.e8a8c5ca.js";import"./useRefs.77e757f9.js";import"./Form.be6a34f6.js";import"./Row.368c65f6.js";import"./useFlexGapSupport.20ae4a44.js";import"./toInteger.6d763759.js";import"./Col.5a4e1b28.js";import"./useSize.48fdc38e.js";import"./index.88ecfd13.js";import"./index.32457c96.js";import"./uniqBy.b254c588.js";import"./useForm.b2949832.js";import"./index.27ebe66e.js";import"./index.d87b86ee.js";import"./index.8bdac382.js";import"./onMountedOrActivated.f9a7813e.js";import"./useContentViewHeight.49fde9ac.js";import"./ArrowLeftOutlined.ada3a7c9.js";import"./index.9b1940b4.js";import"./transButton.339ada11.js";import"./uuid.2b29000c.js";import"./merge.f321b105.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.43914e4e.js";import"./index.f93c2cff.js";import"./scrollTo.39f4a54d.js";import"./index.a3bc6812.js";import"./index.64609094.js";import"./index.54a0672f.js";import"./download.434637e8.js";import"./base64Conver.08b9f4ec.js";const{t:g}=k(),H=[{title:g("AccessControl.dept.id"),dataIndex:"id",width:50},{title:g("AccessControl.cate.selected"),dataIndex:"selected",edit:!0,editRow:!1,editable:!1,editComponent:"Checkbox",editComponentProps:{},editValueMap:e=>e?"Y":"N",width:200},{title:g("AccessControl.cate.contain_child"),dataIndex:"containChild",edit:!0,editRow:!1,editable:!1,editComponent:"Checkbox",editComponentProps:{},editValueMap:e=>e?"Y":"N",width:200},{title:g("AccessControl.cate.name"),dataIndex:"name",width:150,align:"left"}],J=M({name:"DeptCategoryManagement",components:{BasicTable:x,BasicModal:N,TableAction:F,Checkbox:P,Col:q,Divider:$,Row:G},setup(){const{t:e}=k(),t=R({deptId:null,cateId:null,parentCate:!1}),s=h([]),n=h(!1),u=h(null),c=h(!1);function C(){return I(this,null,function*(){return z(t)})}const[i,{reload:o}]=U({isTreeTable:!1,api:C,columns:H,rowKey:"id",pagination:!1,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!1,canResize:!1,immediate:!0,handleSearchInfoFn(a){return a},actionColumn:{width:80,title:e("common.action"),dataIndex:"action",slots:{customRender:"action"}}}),[l,{setModalProps:m,closeModal:b}]=V(a=>I(this,null,function*(){c.value=a.record.ownsAllCategory,t.deptId=a.record.id,t.cateId=null,yield o()}));function w(){b()}function r(a){t.cateId=a.parentId,t.parentCate=!0,o()}function A(a){t.cateId=a.id,t.parentCate=!1,o()}function T({record:a,key:y,value:_}){try{m({confirmLoading:!0}),n.value=!0,K(t.deptId,[{id:a.id,selected:y==="selected"?_:a.selected,containChild:y==="containChild"?_:a.containChild}])}finally{m({confirmLoading:!1}),n.value=!1}}function v(){try{m({confirmLoading:!0}),n.value=!0,Y(t.deptId,c.value)}finally{m({confirmLoading:!1}),n.value=!1}}return{t:e,isEmpty:j,loading:n,deptCateTable:u,ownsAllCategory:c,registerTable:i,registerModal:l,handleOk:w,handleUp:r,handleDown:A,beforeEditSubmit:T,handleOwnsAllCategory:v,checkedKeys:s,searchInfo:t}}});function Q(e,t,s,n,u,c){const C=p("Checkbox"),i=p("Col"),o=p("Divider"),l=p("TableAction"),m=p("BasicTable"),b=p("Row"),w=p("BasicModal");return B(),S(w,E(e.$attrs,{onRegister:e.registerModal,title:e.t("AccessControl.dept.edit_category"),onOk:e.handleOk,cancelButtonProps:{hidden:!0},width:800,"min-height":400}),{default:f(()=>[d(b,null,{default:f(()=>[d(i,{span:24},{default:f(()=>[d(C,{checked:e.ownsAllCategory,"onUpdate:checked":t[0]||(t[0]=r=>e.ownsAllCategory=r),onChange:e.handleOwnsAllCategory},{default:f(()=>[L(O(e.t("AccessControl.dept.own_all_cate")),1)]),_:1},8,["checked","onChange"])]),_:1}),d(o),d(i,{span:24},{default:f(()=>[d(m,{ref:"deptCateTable",onRegister:e.registerTable,searchInfo:e.searchInfo,beforeEditSubmit:e.beforeEditSubmit},{action:f(({record:r})=>[d(l,{"stop-button-propagation":!0,actions:[{icon:"bi:file-arrow-up",onClick:e.handleUp.bind(null,r),ifShow:r.parentId!=null},{icon:"bi:file-arrow-down",onClick:e.handleDown.bind(null,r),ifShow:!r.isLeaf}]},null,8,["actions"])]),_:1},8,["onRegister","searchInfo","beforeEditSubmit"])]),_:1})]),_:1})]),_:1},16,["onRegister","title","onOk"])}var it=D(J,[["render",Q]]);export{it as default};
