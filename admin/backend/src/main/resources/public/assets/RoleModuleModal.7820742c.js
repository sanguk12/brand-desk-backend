var R=(e,a,o)=>new Promise((h,n)=>{var g=l=>{try{t(o.next(l))}catch(i){n(i)}},f=l=>{try{t(o.throw(l))}catch(i){n(i)}},t=l=>l.done?h(l.value):Promise.resolve(l.value).then(g,f);t((o=o.apply(e,a)).next())});import{ap as D,a as b,c as L,s as d,v as O,ar as m,o as A,j as I,y as u,n as p,z as w,t as C,k as K,as as $}from"./index.9b68f3a5.js";import{C as N}from"./index.e9a061d5.js";/* empty css              */import{D as S}from"./index.c90ef721.js";import{B as P,a as V}from"./index.c6d9e38a.js";import{_ as U,T as j}from"./index.44805738.js";import{a as z,b as E,c as q,e as F}from"./role.c49c087f.js";import{f as G}from"./pickDeep.63c4da24.js";import{i as H}from"./isEmpty.7bce0800.js";import{C as J}from"./index.b8e26f6f.js";import{R as Q}from"./index.b9fae046.js";import"./Checkbox.0353578e.js";import"./useWindowSizeFn.d868051d.js";import"./FullscreenOutlined.33f2b7f2.js";import"./index.6b109d0e.js";import"./eagerComputed.4def26ea.js";import"./useContextMenu.49129f71.js";import"./get.8f01bfdb.js";import"./merge.f321b105.js";import"./_baseEach.e6ca9cd4.js";import"./toInteger.6d763759.js";import"./_baseIteratee.f572c494.js";import"./_baseProperty.2030e337.js";import"./Col.5a4e1b28.js";import"./Row.368c65f6.js";import"./useFlexGapSupport.20ae4a44.js";const W=b({name:"RoleModuleManagement",components:{BasicModal:P,Checkbox:N,BasicTree:U,TreeIcon:j,Col:J,Divider:S,Row:Q},setup(){const{t:e}=L(),a=d(),o=O({roleId:null,moduleId:null}),h=d([]),n=d(!1),g=d([]),f=d(null),t=d(!1),l=d(!1),[i,{setModalProps:c}]=V(s=>R(this,null,function*(){t.value=s.record.ownsAllModule,l.value=s.record.ownsAllRight,o.roleId=s.record.id;const y=yield z({roleId:o.roleId});g.value=y;const M=G(y,(_,Y,B)=>B.selected,{childrenPath:["children"]});h.value=M==null?[]:M.map(_=>_.id)}));function k(){try{c({confirmLoading:!0}),n.value=!0,E(o.roleId,t.value)}finally{c({confirmLoading:!1}),n.value=!1}}function v(){try{c({confirmLoading:!0}),n.value=!0,q(o.roleId,t.value)}finally{c({confirmLoading:!1}),n.value=!1}}function r(){try{c({confirmLoading:!0}),n.value=!0;const s=a.value.getCheckedKeys().checked;F(o.roleId,s)}finally{c({confirmLoading:!1}),n.value=!1}}function T({icon:s}){return s}return{t:e,isEmpty:H,moduleTreeRef:a,loading:n,treeData:g,roleCateTable:f,ownsAllModule:t,ownsAllRight:l,registerModal:i,handleOwnsAllModule:k,handleOwnsAllRight:v,handleSave:r,checkedKeys:h,searchInfo:o,getTreeIcon:T}}});function X(e,a,o,h,n,g){const f=m("Checkbox"),t=m("Col"),l=m("Divider"),i=m("TreeIcon"),c=m("BasicTree"),k=m("Row"),v=m("BasicModal");return A(),I(v,$(e.$attrs,{onRegister:e.registerModal,title:e.t("AccessControl.role.edit_module"),onOk:e.handleSave,cancelButtonProps:{hidden:!0},width:800,"min-height":400}),{default:u(()=>[p(k,null,{default:u(()=>[p(t,{span:24},{default:u(()=>[p(f,{checked:e.ownsAllModule,"onUpdate:checked":a[0]||(a[0]=r=>e.ownsAllModule=r),onChange:e.handleOwnsAllModule},{default:u(()=>[w(C(e.t("AccessControl.role.own_all_module")),1)]),_:1},8,["checked","onChange"]),p(f,{checked:e.ownsAllRight,"onUpdate:checked":a[1]||(a[1]=r=>e.ownsAllRight=r),onChange:e.handleOwnsAllRight},{default:u(()=>[w(C(e.t("AccessControl.role.own_all_right")),1)]),_:1},8,["checked","onChange"])]),_:1}),p(l),p(t,{span:24},{default:u(()=>[p(c,{ref:"moduleTreeRef",checkable:!0,checkStrictly:!0,selectable:!1,treeData:e.treeData,checkedKeys:e.checkedKeys,fieldNames:{key:"id",children:"children"}},{title:u(r=>[r.icon?(A(),I(i,{key:0,icon:e.getTreeIcon(r)},null,8,["icon"])):K("",!0),w(" "+C(r.enName),1)]),_:1},8,["treeData","checkedKeys"])]),_:1})]),_:1})]),_:1},16,["onRegister","title","onOk"])}var Ae=D(W,[["render",X]]);export{Ae as default};
