var Se=Object.defineProperty,Pe=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var K=(e,t,n)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))Ie.call(t,n)&&K(e,n,t[n]);if(Y)for(var n of Y(t))ke.call(t,n)&&K(e,n,t[n]);return e},F=(e,t)=>Pe(e,Ue(t));var G=(e,t,n)=>new Promise((r,o)=>{var f=a=>{try{u(n.next(a))}catch(l){o(l)}},d=a=>{try{u(n.throw(a))}catch(l){o(l)}},u=a=>a.done?r(a.value):Promise.resolve(a.value).then(f,d);u((n=n.apply(e,t)).next())});import{n as c,aZ as Le,f as T,c as x,i as R,R as Re,Q as Te,dG as Ae,a as B,b4 as oe,dH as Oe,bV as Me,bi as ae,aC as E,b as $e,dI as De,ap as j,aD as Ne,ar as v,o as b,h as M,F as N,au as Be,j as k,y as w,av as Fe,k as L,q as V,ae as ee,z as $,t as D,aw as W,ax as Ee,as as z,bo as ze,aq as X,X as J,ad as xe,v as je,s as H,ba as Ge,m as He,D as Ve,dJ as We,dm as le,ag as Ze,ay as qe}from"./index.0a8b89be.js";import{S as Xe}from"./index.b2d27a9d.js";import{u as Je,B as se,a as re,b as te}from"./index.b536e7c7.js";import{U as Qe}from"./index.14314bc3.js";import{P as Ye}from"./index.ac3b1fda.js";import{A as Ke}from"./index.bacabee8.js";import{T as Z}from"./index.5485e619.js";import{D as et}from"./index.8eadf802.js";import{I as tt}from"./index.4a0da81f.js";import{b as nt}from"./uuid.2b29000c.js";import{d as ot}from"./download.edb4e6af.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},lt=at;function ne(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),r.forEach(function(o){st(e,o,n[o])})}return e}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q=function(t,n){var r=ne({},t,n.attrs);return c(Le,ne({},r,{icon:lt}),null)};Q.displayName="MoreOutlined";Q.inheritAttrs=!1;var rt=Q;const ie={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:{}},api:{type:Function,default:null,required:!0},name:{type:String,default:"file"},filename:{type:String,default:null}},it=F(I({value:{type:Array,default:()=>[]}},ie),{showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),ut={value:{type:Array,default:()=>[]}},ct={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}},{t:q}=x();function dt({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:r}){const o=T(()=>{const u=R(e);return u&&u.length>0?u:[]}),f=T(()=>R(o).map(u=>u.indexOf("/")>0||u.startsWith(".")?u:`.${u}`).join(",")),d=T(()=>{const u=R(t);if(u)return u;const a=[],l=R(e);l.length>0&&a.push(q("component.upload.accept",[l.join(",")]));const i=R(r);i&&a.push(q("component.upload.maxSize",[i]));const s=R(n);return s&&s!==1/0&&a.push(q("component.upload.maxNumber",[s])),a.join("\uFF0C")});return{getAccept:o,getStringAccept:f,getHelpText:d}}var C=(e=>(e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e))(C||{});function pt(e){return ue(e.name)}function ue(e){return/\.(jpg|jpeg|png|gif)$/i.test(e)}function mt(e){return new Promise((t,n)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t({result:r.result,file:e}),r.onerror=o=>n(o)})}const ce=Symbol("basic-table");function en(e){Te(ce,e)}function ft(){return Re(ce)}const{table:gt}=Ae,{pageSizeOptions:vt,defaultPageSize:ht,fetchSetting:bt,defaultSize:yt,defaultSortFn:_t,defaultFilterFn:wt}=gt,tn="key",nn=vt,on=ht,an=bt,ln=yt,sn=_t,rn=wt,un="center",cn="INDEX",Ct="ACTION";const St=B({name:"TableAction",components:{Icon:oe,PopConfirmButton:Oe,Divider:et,Dropdown:Me,MoreOutlined:rt,Tooltip:ae},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},divider:E.bool.def(!0),outside:E.bool,stopButtonPropagation:E.bool.def(!1)},setup(e){const{prefixCls:t}=$e("basic-table-action");let n={};e.outside||(n=ft());const{hasPermission:r}=De();function o(i){const s=i.ifShow;let h=!0;return ze(s)&&(h=s),X(s)&&(h=s(i)),h}const f=T(()=>(ee(e.actions)||[]).filter(i=>r(i.auth)&&o(i)).map(i=>{const{popConfirm:s}=i;return F(I(I({getPopupContainer:()=>{var h;return(h=R(n==null?void 0:n.wrapRef.value))!=null?h:document.body},type:"link",size:"small"},i),s||{}),{onConfirm:s==null?void 0:s.confirm,onCancel:s==null?void 0:s.cancel,enable:!!s})})),d=T(()=>{const i=(ee(e.dropDownActions)||[]).filter(s=>r(s.auth)&&o(s));return i.map((s,h)=>{const{label:p,popConfirm:g}=s;return F(I(I({},s),g),{onConfirm:g==null?void 0:g.confirm,onCancel:g==null?void 0:g.cancel,text:p,divider:h<i.length-1?e.divider:!1})})}),u=T(()=>{var h,p;const s=(((h=n==null?void 0:n.getColumns)==null?void 0:h.call(n))||[]).find(g=>g.flag===Ct);return(p=s==null?void 0:s.align)!=null?p:"left"});function a(i){return I({getPopupContainer:()=>{var s;return(s=R(n==null?void 0:n.wrapRef.value))!=null?s:document.body},placement:"bottom"},Ne(i)?{title:i}:i)}function l(i){if(!e.stopButtonPropagation)return;i.composedPath().find(p=>{var g;return((g=p.tagName)==null?void 0:g.toUpperCase())==="BUTTON"})&&i.stopPropagation()}return{prefixCls:t,getActions:f,getDropdownList:d,getAlign:u,onCellClick:l,getTooltip:a}}});function Pt(e,t,n,r,o,f){const d=v("Icon"),u=v("PopConfirmButton"),a=v("Tooltip"),l=v("Divider"),i=v("MoreOutlined"),s=v("a-button"),h=v("Dropdown");return b(),M("div",{class:V([e.prefixCls,e.getAlign]),onClick:t[0]||(t[0]=(...p)=>e.onCellClick&&e.onCellClick(...p))},[(b(!0),M(N,null,Be(e.getActions,(p,g)=>(b(),M(N,{key:`${g}-${p.label}`},[p.tooltip?(b(),k(a,W(z({key:0},e.getTooltip(p.tooltip))),{default:w(()=>[c(u,W(Ee(p)),{default:w(()=>[p.icon?(b(),k(d,{key:0,icon:p.icon,class:V({"mr-1":!!p.label})},null,8,["icon","class"])):L("",!0),p.label?(b(),M(N,{key:1},[$(D(p.label),1)],64)):L("",!0)]),_:2},1040)]),_:2},1040)):(b(),k(u,W(z({key:1},p)),{default:w(()=>[p.icon?(b(),k(d,{key:0,icon:p.icon,class:V({"mr-1":!!p.label})},null,8,["icon","class"])):L("",!0),p.label?(b(),M(N,{key:1},[$(D(p.label),1)],64)):L("",!0)]),_:2},1040)),e.divider&&g<e.getActions.length-1?(b(),k(l,{key:2,type:"vertical",class:"action-divider"})):L("",!0)],64))),128)),e.dropDownActions&&e.getDropdownList.length>0?(b(),k(h,{key:0,trigger:["hover"],dropMenuList:e.getDropdownList,popconfirm:""},{default:w(()=>[Fe(e.$slots,"more"),e.$slots.more?L("",!0):(b(),k(s,{key:0,type:"link",size:"small"},{default:w(()=>[c(i,{class:"icon-more"})]),_:1}))]),_:3},8,["dropMenuList"])):L("",!0)],2)}var de=j(St,[["render",Pt]]);const Ut=B({components:{Image:tt},props:{fileUrl:E.string.def(""),fileName:E.string.def("")}}),It={class:"thumb"};function kt(e,t,n,r,o,f){const d=v("Image");return b(),M("span",It,[e.fileUrl?(b(),k(d,{key:0,src:e.fileUrl,width:104},null,8,["src"])):L("",!0)])}var pe=j(Ut,[["render",kt]]);const{t:S}=x();function Lt(){return[{dataIndex:"thumbUrl",title:S("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&c(pe,{fileUrl:t},null)}},{dataIndex:"name",title:S("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:n,status:r}=t||{};let o="normal";return r===C.ERROR?o="exception":r===C.UPLOADING?o="active":r===C.SUCCESS&&(o="success"),c("span",null,[c("p",{class:"truncate mb-1",title:e},[e]),c(Ye,{percent:n,size:"small",status:o},null)])}},{dataIndex:"size",title:S("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:S("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===C.SUCCESS?c(Z,{color:"green"},{default:()=>S("component.upload.uploadSuccess")}):e===C.ERROR?c(Z,{color:"red"},{default:()=>S("component.upload.uploadError")}):e===C.UPLOADING?c(Z,{color:"blue"},{default:()=>S("component.upload.uploading")}):e}]}function Rt(e){return{width:120,title:S("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:t})=>{const n=[{label:S("component.upload.del"),color:"error",onClick:e.bind(null,t)}];return c(de,{actions:n,outside:!0},null)}}}function Tt(){return[{dataIndex:"url",title:S("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return ue(t)&&c(pe,{fileUrl:t},null)}},{dataIndex:"name",title:S("component.upload.fileName"),align:"left"}]}function At({handleRemove:e,handleDownload:t}){return{width:160,title:S("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:n})=>{const r=[{label:S("component.upload.del"),color:"error",onClick:e.bind(null,n)},{label:S("component.upload.download"),onClick:t.bind(null,n)}];return c(de,{actions:r,outside:!0},null)}}}var me=B({name:"FileList",props:ct,setup(e){const t=Je();return J(()=>e.dataSource,()=>{xe(()=>{var n;(n=t==null?void 0:t.redoModalHeight)==null||n.call(t)})}),()=>{const{columns:n,actionColumn:r,dataSource:o}=e,f=[...n,r];return c("table",{class:"file-table"},[c("colgroup",null,[f.map(d=>{const{width:u=0,dataIndex:a}=d,l={width:`${u}px`,minWidth:`${u}px`};return c("col",{style:u?l:{},key:a},null)})]),c("thead",null,[c("tr",{class:"file-table-tr"},[f.map(d=>{const{title:u="",align:a="center",dataIndex:l}=d;return c("th",{class:["file-table-th",a],key:l},[u])})])]),c("tbody",null,[o.map((d={},u)=>c("tr",{class:"file-table-tr",key:`${u+d.name||""}`},[f.map(a=>{const{dataIndex:l="",customRender:i,align:s="center"}=a,h=i&&X(i);return c("td",{class:["file-table-td",s],key:l},[h?i==null?void 0:i({text:d[l],record:d}):d[l]])})]))])])}}});const Ot=B({components:{BasicModal:se,Upload:Qe,Alert:Ke,FileList:me},props:F(I({},ie),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const n=je({fileList:[]}),r=H(!1),o=H([]),{accept:f,helpText:d,maxNumber:u,maxSize:a}=Ge(e),{t:l}=x(),[i,{closeModal:s}]=re(),{getStringAccept:h,getHelpText:p}=dt({acceptRef:f,helpTextRef:d,maxNumberRef:u,maxSizeRef:a}),{createMessage:g}=Ve(),_=T(()=>o.value.length>0&&!o.value.every(m=>m.status===C.SUCCESS)),fe=T(()=>{const m=o.value.some(y=>y.status===C.SUCCESS);return{disabled:r.value||o.value.length===0||!m}}),ge=T(()=>{const m=o.value.some(y=>y.status===C.ERROR);return r.value?l("component.upload.uploading"):l(m?"component.upload.reUploadFailed":"component.upload.startUpload")});function ve(m){const{size:y,name:P}=m,{maxSize:U}=e;if(U&&m.size/1024/1024>=U)return g.error(l("component.upload.maxSizeMultiple",[U])),!1;const O={uuid:nt(),file:m,size:y,name:P,percent:0,type:P.split(".").pop()};return pt(m)?mt(m).then(({result:A})=>{o.value=[...R(o),I({thumbUrl:A},O)]}):o.value=[...R(o),O],!1}function he(m){const y=o.value.findIndex(P=>P.uuid===m.uuid);y!==-1&&o.value.splice(y,1),t("delete",m)}function be(m){return G(this,null,function*(){var P;const{api:y}=e;if(!y||!X(y))return We("upload api must exist and be a function");try{m.status=C.UPLOADING;const{data:U}=yield(P=e.api)==null?void 0:P.call(e,{data:I({},e.uploadParams||{}),file:m.file,name:e.name,filename:e.filename},function(A){const Ce=A.loaded/A.total*100|0;m.percent=Ce});return m.status=C.SUCCESS,m.responseData=U,{success:!0,error:null}}catch(U){return m.status=C.ERROR,{success:!1,error:U}}})}function ye(){return G(this,null,function*(){var y;const{maxNumber:m}=e;if(o.value.length+((y=e.previewFileList)==null?void 0:y.length)>m)return g.warning(l("component.upload.maxNumber",[m]));try{r.value=!0;const P=o.value.filter(A=>A.status!==C.SUCCESS)||[],U=yield Promise.all(P.map(A=>be(A)));r.value=!1;const O=U.filter(A=>!A.success);if(O.length>0)throw O}catch(P){throw r.value=!1,P}})}function _e(){const{maxNumber:m}=e;if(o.value.length>m)return g.warning(l("component.upload.maxNumber",[m]));if(r.value)return g.warning(l("component.upload.saveWarn"));const y=[];for(const P of o.value){const{status:U,responseData:O}=P;U===C.SUCCESS&&O&&y.push(O.result)}if(y.length<=0)return g.warning(l("component.upload.saveError"));o.value=[],s(),t("change",y)}function we(){return G(this,null,function*(){return r.value?(g.warning(l("component.upload.uploadWait")),!1):(o.value=[],!0)})}return{columns:Lt(),actionColumn:Rt(he),register:i,closeModal:s,getHelpText:p,getStringAccept:h,getOkButtonProps:fe,beforeUpload:ve,fileListRef:o,state:n,isUploadingRef:r,handleStartUpload:ye,handleOk:_e,handleCloseFunc:we,getIsSelectFile:_,getUploadBtnText:ge,t:l}}}),Mt={class:"upload-modal-toolbar"};function $t(e,t,n,r,o,f){const d=v("a-button"),u=v("Alert"),a=v("Upload"),l=v("FileList"),i=v("BasicModal");return b(),k(i,z({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,class:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerFooter:w(()=>[c(d,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:w(()=>[$(D(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:w(()=>[He("div",Mt,[c(u,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),c(a,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,"show-upload-list":!1,class:"upload-modal-toolbar__btn"},{default:w(()=>[c(d,{type:"primary"},{default:w(()=>[$(D(e.t("component.upload.choose")),1)]),_:1})]),_:1},8,["accept","multiple","before-upload"])]),c(l,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])}var Dt=j(Ot,[["render",$t]]);const Nt=B({components:{BasicModal:se,FileList:me},props:ut,emits:["list-change","register","delete"],setup(e,{emit:t}){const[n,{closeModal:r}]=re(),{t:o}=x(),f=H([]);J(()=>e.value,a=>{le(a)||(a=[]),f.value=a.filter(l=>!!l).map(l=>({url:"/webfile"+l.filePath,type:l.fileType,name:l.fileName}))},{immediate:!0});function d(a){const l=f.value.findIndex(i=>i.url===a.url);if(l!==-1){const i=f.value.splice(l,1);t("delete",i[0].url),t("list-change",f.value.map(s=>s.url))}}function u(a){const{url:l=""}=a;ot({url:l})}return{t:o,register:n,closeModal:r,fileListRef:f,columns:Tt(),actionColumn:At({handleRemove:d,handleDownload:u})}}});function Bt(e,t,n,r,o,f){const d=v("FileList"),u=v("BasicModal");return b(),k(u,z({width:"800px",title:e.t("component.upload.preview"),class:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:w(()=>[c(d,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}var Ft=j(Nt,[["render",Bt]]);const Et=B({name:"BasicUpload",components:{UploadModal:Dt,Space:Xe,UploadPreviewModal:Ft,Icon:oe,Tooltip:ae},props:it,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:n}){const{t:r}=x(),[o,{openModal:f}]=te(),[d,{openModal:u}]=te(),a=H([]),l=T(()=>{const{emptyHidePreview:_}=e;return _&&_?a.value.length>0:!0}),i=T(()=>{const _=I(I({},n),e);return Ze(_,"onChange")});J(()=>e.value,(_=[])=>{a.value=le(_)?_:[]},{immediate:!0});function s(_){a.value=[...R(a),..._||[]],t("update:value",a.value),t("change",a.value)}function h(_){a.value=[..._||[]],t("update:value",a.value),t("change",a.value)}function p(_){t("delete",_)}function g(_){t("preview-delete",_)}return{registerUploadModal:o,openUploadModal:f,handleChange:s,handlePreviewChange:h,registerPreviewModal:d,openPreviewModal:u,fileList:a,showPreview:l,bindValue:i,handleDelete:p,handlePreviewDelete:g,t:r}}});function zt(e,t,n,r,o,f){const d=v("a-button"),u=v("Icon"),a=v("Tooltip"),l=v("Space"),i=v("UploadModal"),s=v("UploadPreviewModal");return b(),M("div",null,[c(l,null,{default:w(()=>[c(d,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:w(()=>[$(D(e.t("component.upload.upload")),1)]),_:1},8,["onClick"]),e.showPreview?(b(),k(a,{key:0,placement:"bottom"},{title:w(()=>[$(D(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(b(),M(N,{key:0},[$(D(e.fileList.length),1)],64)):L("",!0)]),default:w(()=>[c(d,{onClick:e.openPreviewModal},{default:w(()=>[c(u,{icon:"bi:eye"}),e.fileList.length&&e.showPreviewNumber?(b(),M(N,{key:0},[$(D(e.fileList.length),1)],64)):L("",!0)]),_:1},8,["onClick"])]),_:1})):L("",!0)]),_:1}),c(i,z(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),c(s,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}var xt=j(Et,[["render",zt]]);const dn=qe(xt);export{Ct as A,dn as B,un as D,an as F,cn as I,on as P,tn as R,de as T,nn as a,sn as b,rn as c,ln as d,en as e,xt as f,ft as u};
