var w=Math.pow;var u=(e,i,t)=>new Promise((n,r)=>{var p=a=>{try{d(t.next(a))}catch(c){r(c)}},o=a=>{try{d(t.throw(a))}catch(c){r(c)}},d=a=>a.done?n(a.value):Promise.resolve(a.value).then(p,o);d((t=t.apply(e,i)).next())});import{fF as F,fN as U,c as y,bQ as T,b4 as v,eb as D,dz as B,ap as Y,a as A,s as z,ar as f,o as M,h as L,n as g,y as C,j,z as H,t as W,k as P,a7 as b,D as R}from"./index.f8b6fa94.js";import{B as Z}from"./TableImg.9ee05584.js";import{f as $,T as E}from"./index.26a558af.js";import{u as V}from"./useTable.1012c757.js";import{u as G}from"./upload.516cd581.js";import{t as K}from"./toInteger.443f55d3.js";import"./index.1423091e.js";import"./Checkbox.572a0527.js";import"./index.20e31dae.js";import"./index.961d34d0.js";import"./eagerComputed.d49f1c93.js";import"./BasicForm.eebb9e8d.js";/* empty css               *//* empty css              */import"./index.bec743a7.js";import"./index.e501ff06.js";import"./index.5c9fe55c.js";import"./index.12c7904d.js";import"./index.345349a2.js";import"./get.12156efd.js";import"./index.1efac556.js";import"./_baseEach.2d110e96.js";import"./_baseIteratee.07173297.js";import"./_baseProperty.2030e337.js";import"./DeleteOutlined.c60a3e36.js";import"./index.65e8311b.js";import"./useRefs.25abb648.js";import"./Form.42748d5d.js";import"./Row.0bd81407.js";import"./useFlexGapSupport.816f6ec3.js";import"./Col.b99e5aca.js";import"./useSize.3eb1ac1b.js";import"./index.5ddb8e93.js";import"./index.ae9da7c5.js";import"./useWindowSizeFn.268c75c1.js";import"./index.b3bb861d.js";import"./uniqBy.ed970345.js";import"./index.0c1d45ad.js";import"./FullscreenOutlined.8522ef3f.js";import"./index.8ffde185.js";import"./useForm.74156ad2.js";import"./index.7cdcb74e.js";import"./index.fd9bf113.js";import"./index.7880b903.js";import"./onMountedOrActivated.73153770.js";import"./useContentViewHeight.a5b3eda6.js";import"./ArrowLeftOutlined.2c75bf82.js";import"./index.fad130bb.js";import"./transButton.7ec2a071.js";import"./uuid.2b29000c.js";import"./merge.a3bec796.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.53735e83.js";import"./index.29f29e0d.js";import"./scrollTo.7fe5bdbc.js";import"./index.55183d61.js";import"./index.a4095fd7.js";import"./index.c3665e07.js";import"./download.3a5cff84.js";import"./base64Conver.08b9f4ec.js";function Q(e,i,t){return e===e&&(t!==void 0&&(e=e<=t?e:t),i!==void 0&&(e=e>=i?e:i)),e}function q(e,i,t){e=F(e),i=U(i);var n=e.length;t=t===void 0?n:Q(K(t),0,n);var r=t;return t-=i.length,t>=0&&e.slice(t,r)==i}function J(e,i=!1,t=1){const n=i?1e3:1024;if(Math.abs(e)<n)return e+" B";const r=i?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let p=-1;const o=w(10,t);do e/=n,++p;while(Math.round(Math.abs(e)*o)/o>=n&&p<r.length-1);return e.toFixed(t)+" "+r[p]}const{t:h}=y(),O=[{title:"",dataIndex:"directory",width:150,customRender:({record:e})=>e.directory?T(v,{icon:"clarity:directory-solid",class:"mr-1"}):T(v,{icon:"ant-design:file-text-filled",class:"mr-1"})},{title:h("Content.file.name"),dataIndex:"fileName",width:150,align:"left"},{title:h("Content.file.create_date"),dataIndex:"creationTime",format:(e,i,t)=>i.createDate===null?"":D(i.createDate,"YYYY-MM-DD HH:mm:ss"),width:130},{title:h("Content.file.update_date"),dataIndex:"lastModifiedTime",format:(e,i,t)=>i.createDate===null?"":D(i.createDate,"YYYY-MM-DD HH:mm:ss"),width:130},{title:h("Content.file.size"),dataIndex:"size",format:(e,i,t)=>J(i.size),width:130}];function X(e){return B.get({url:"/api/cmsWebFile/list",params:e})}function ee(e){return B.post({url:"/api/cmsWebFile/zip",params:{path:e}})}function te(e){return B.post({url:"/api/cmsWebFile/unzip",params:{path:e}})}function ie(e){return B.post({url:"/api/cmsWebFile/delete",params:{paths:e}})}const oe=A({name:"ModuleManagement",components:{BasicUpload:$,BasicTable:Z,TableAction:E},setup(){const{t:e}=y(),i=z([]),t=z([]),{createSuccessModal:n}=R();function r(){return u(this,null,function*(){return X({path:t.value.join("/")})})}const[p,{reload:o,expandAll:d,collapseAll:a}]=V({title:e("Content.file.list"),isTreeTable:!1,api:r,columns:O,pagination:!1,striped:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,showIndexColumn:!1,canResize:!1,rowKey:"id",actionColumn:{width:100,title:e("common.action"),dataIndex:"action",slots:{customRender:"action"},fixed:void 0}});function c(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName);const x=yield ie(m.join("/"));n({title:e("common.info"),content:e("Content.file.deleted")}),o()})}function l(){o()}function _(){t.value.length>0&&t.value.pop(),o()}function k(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName),yield ee(m.join("/")),o()})}function I(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName),yield te(m.join("/")),o()})}function N(s){t.value.push(s.fileName),o()}function S(s){i.value=[],o()}return{t:e,expandAll:d,collapseAll:a,registerTable:p,handleDelete:c,handleSuccess:l,handleUp:_,handleUnzip:I,handleZip:k,handleDown:N,uploadApi:G,handleUploadChange:S,uploadedList:i,pathList:t,endsWith:q}}});function ne(e,i,t,n,r,p){const o=f("BasicUpload"),d=f("a-button"),a=f("TableAction"),c=f("BasicTable");return M(),L("div",null,[g(c,{onRegister:e.registerTable},{toolbar:C(()=>[g(o,{api:e.uploadApi,maxNumber:100,uploadParams:{path:e.pathList.join("/")},emptyHidePreview:!0,onChange:e.handleUploadChange,value:e.uploadedList,"onUpdate:value":i[0]||(i[0]=l=>e.uploadedList=l)},null,8,["api","uploadParams","onChange","value"]),e.pathList.length>0?(M(),j(d,{key:0,type:"primary",preIcon:"bi:file-arrow-up",onClick:e.handleUp},{default:C(()=>[H(W(e.t("Content.file.go_parent")),1)]),_:1},8,["onClick"])):P("",!0)]),action:C(({record:l})=>[g(a,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"Deletion Confirm",confirm:e.handleDelete.bind(null,l)}},{icon:"ph:file-zip-fill",onClick:e.handleZip.bind(null,l),ifShow:l.directory},{icon:"ph:file-zip-light",onClick:e.handleUnzip.bind(null,l),ifShow:e.endsWith(l.fileName,".zip")},{icon:"tabler:file-arrow-right",onClick:e.handleDown.bind(null,l),ifShow:l.directory}]},null,8,["actions"])]),_:1},8,["onRegister"])])}var ct=Y(oe,[["render",ne]]);export{ct as default};
