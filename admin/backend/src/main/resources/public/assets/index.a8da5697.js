var w=Math.pow;var u=(e,i,t)=>new Promise((n,r)=>{var p=a=>{try{d(t.next(a))}catch(c){r(c)}},o=a=>{try{d(t.throw(a))}catch(c){r(c)}},d=a=>a.done?n(a.value):Promise.resolve(a.value).then(p,o);d((t=t.apply(e,i)).next())});import{fF as F,fN as U,c as y,bQ as T,b4 as v,eb as D,dz as B,ap as Y,a as A,s as z,ar as f,o as M,h as L,n as g,y as C,j,z as H,t as W,k as P,a7 as b,D as R}from"./index.9b68f3a5.js";import{B as Z}from"./TableImg.56506859.js";import{f as $,T as E}from"./index.3604fdfb.js";import{u as V}from"./useTable.bd2598d0.js";import{u as G}from"./upload.b58fb754.js";import{t as K}from"./toInteger.6d763759.js";import"./index.7b6b1e1d.js";import"./Checkbox.0353578e.js";import"./index.e9a061d5.js";import"./index.6b109d0e.js";import"./eagerComputed.4def26ea.js";import"./BasicForm.6899d0a5.js";/* empty css               *//* empty css              */import"./index.c90ef721.js";import"./index.6344e34d.js";import"./index.ea5e7c7e.js";import"./index.f5ce31a5.js";import"./index.8a286a94.js";import"./get.8f01bfdb.js";import"./index.3fe76539.js";import"./_baseEach.e6ca9cd4.js";import"./_baseIteratee.f572c494.js";import"./_baseProperty.2030e337.js";import"./DeleteOutlined.8d0b60c9.js";import"./index.e8a8c5ca.js";import"./useRefs.77e757f9.js";import"./Form.be6a34f6.js";import"./Row.368c65f6.js";import"./useFlexGapSupport.20ae4a44.js";import"./Col.5a4e1b28.js";import"./useSize.48fdc38e.js";import"./index.88ecfd13.js";import"./index.32457c96.js";import"./useWindowSizeFn.d868051d.js";import"./index.b8e26f6f.js";import"./uniqBy.b254c588.js";import"./index.c6d9e38a.js";import"./FullscreenOutlined.33f2b7f2.js";import"./index.b9fae046.js";import"./useForm.b2949832.js";import"./index.27ebe66e.js";import"./index.d87b86ee.js";import"./index.8bdac382.js";import"./onMountedOrActivated.f9a7813e.js";import"./useContentViewHeight.49fde9ac.js";import"./ArrowLeftOutlined.ada3a7c9.js";import"./index.9b1940b4.js";import"./transButton.339ada11.js";import"./uuid.2b29000c.js";import"./merge.f321b105.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.43914e4e.js";import"./index.f93c2cff.js";import"./scrollTo.39f4a54d.js";import"./index.a3bc6812.js";import"./index.64609094.js";import"./index.54a0672f.js";import"./download.434637e8.js";import"./base64Conver.08b9f4ec.js";function Q(e,i,t){return e===e&&(t!==void 0&&(e=e<=t?e:t),i!==void 0&&(e=e>=i?e:i)),e}function q(e,i,t){e=F(e),i=U(i);var n=e.length;t=t===void 0?n:Q(K(t),0,n);var r=t;return t-=i.length,t>=0&&e.slice(t,r)==i}function J(e,i=!1,t=1){const n=i?1e3:1024;if(Math.abs(e)<n)return e+" B";const r=i?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let p=-1;const o=w(10,t);do e/=n,++p;while(Math.round(Math.abs(e)*o)/o>=n&&p<r.length-1);return e.toFixed(t)+" "+r[p]}const{t:h}=y(),O=[{title:"",dataIndex:"directory",width:150,customRender:({record:e})=>e.directory?T(v,{icon:"clarity:directory-solid",class:"mr-1"}):T(v,{icon:"ant-design:file-text-filled",class:"mr-1"})},{title:h("Content.file.name"),dataIndex:"fileName",width:150,align:"left"},{title:h("Content.file.create_date"),dataIndex:"creationTime",format:(e,i,t)=>i.createDate===null?"":D(i.createDate,"YYYY-MM-DD HH:mm:ss"),width:130},{title:h("Content.file.update_date"),dataIndex:"lastModifiedTime",format:(e,i,t)=>i.createDate===null?"":D(i.createDate,"YYYY-MM-DD HH:mm:ss"),width:130},{title:h("Content.file.size"),dataIndex:"size",format:(e,i,t)=>J(i.size),width:130}];function X(e){return B.get({url:"/api/cmsWebFile/list",params:e})}function ee(e){return B.post({url:"/api/cmsWebFile/zip",params:{path:e}})}function te(e){return B.post({url:"/api/cmsWebFile/unzip",params:{path:e}})}function ie(e){return B.post({url:"/api/cmsWebFile/delete",params:{paths:e}})}const oe=A({name:"ModuleManagement",components:{BasicUpload:$,BasicTable:Z,TableAction:E},setup(){const{t:e}=y(),i=z([]),t=z([]),{createSuccessModal:n}=R();function r(){return u(this,null,function*(){return X({path:t.value.join("/")})})}const[p,{reload:o,expandAll:d,collapseAll:a}]=V({title:e("Content.file.list"),isTreeTable:!1,api:r,columns:O,pagination:!1,striped:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,showIndexColumn:!1,canResize:!1,rowKey:"id",actionColumn:{width:100,title:e("common.action"),dataIndex:"action",slots:{customRender:"action"},fixed:void 0}});function c(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName);const x=yield ie(m.join("/"));n({title:e("common.info"),content:e("Content.file.deleted")}),o()})}function l(){o()}function _(){t.value.length>0&&t.value.pop(),o()}function k(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName),yield ee(m.join("/")),o()})}function I(s){return u(this,null,function*(){const m=b(t.value);m.push(s.fileName),yield te(m.join("/")),o()})}function N(s){t.value.push(s.fileName),o()}function S(s){i.value=[],o()}return{t:e,expandAll:d,collapseAll:a,registerTable:p,handleDelete:c,handleSuccess:l,handleUp:_,handleUnzip:I,handleZip:k,handleDown:N,uploadApi:G,handleUploadChange:S,uploadedList:i,pathList:t,endsWith:q}}});function ne(e,i,t,n,r,p){const o=f("BasicUpload"),d=f("a-button"),a=f("TableAction"),c=f("BasicTable");return M(),L("div",null,[g(c,{onRegister:e.registerTable},{toolbar:C(()=>[g(o,{api:e.uploadApi,maxNumber:100,uploadParams:{path:e.pathList.join("/")},emptyHidePreview:!0,onChange:e.handleUploadChange,value:e.uploadedList,"onUpdate:value":i[0]||(i[0]=l=>e.uploadedList=l)},null,8,["api","uploadParams","onChange","value"]),e.pathList.length>0?(M(),j(d,{key:0,type:"primary",preIcon:"bi:file-arrow-up",onClick:e.handleUp},{default:C(()=>[H(W(e.t("Content.file.go_parent")),1)]),_:1},8,["onClick"])):P("",!0)]),action:C(({record:l})=>[g(a,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"Deletion Confirm",confirm:e.handleDelete.bind(null,l)}},{icon:"ph:file-zip-fill",onClick:e.handleZip.bind(null,l),ifShow:l.directory},{icon:"ph:file-zip-light",onClick:e.handleUnzip.bind(null,l),ifShow:e.endsWith(l.fileName,".zip")},{icon:"tabler:file-arrow-right",onClick:e.handleDown.bind(null,l),ifShow:l.directory}]},null,8,["actions"])]),_:1},8,["onRegister"])])}var ct=Y(oe,[["render",ne]]);export{ct as default};
